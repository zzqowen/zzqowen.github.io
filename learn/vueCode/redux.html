<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  
</head>
<body>
  <div id="counter"></div>
  <button id="addBtn">+</button>
  <button id="minusBtn">-</button>
  <script>  
    function createStore(reducer) {
        var state;
        var listeners = [];
        var getState = () => state;
        var dispatch = (action) => {
            state = reducer(state, action);
            console.log(listeners)
            listeners.forEach(l=>l());
        }
        var subscribe = (listener) => {
            listeners.push(listener);
            return () => {
              console.log(666)
                listeners = listeners.filter((l) => l != listener)
            }
        }
        dispatch();
        return {
            getState, dispatch, subscribe
        }
    }
    var reducer = (state = 0, action) => {
        if (!action) return state;
        console.log(action);
        switch (action.type) {
            case 'INCREMENT':
                return state + 1;
            case 'DECREMENT':
                return state - 1;
            default:
                return state;
        }
    }
    var store = createStore(reducer);
    store.subscribe(function () {
      console.log(8888)
        document.querySelector('#counter').innerHTML = store.getState();
    });

    document.querySelector('#addBtn').addEventListener('click', function () {
        store.dispatch({type: 'INCREMENT'});
    });
    document.querySelector('#minusBtn').addEventListener('click', function () {
        store.dispatch({type: 'DECREMENT'});
    });
  </script>
</body>
</html>